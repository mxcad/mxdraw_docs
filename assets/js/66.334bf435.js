(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{669:function(t,a,s){"use strict";s.r(a);var n=s(12),r=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("用户在网页中浏览标注DWG图纸之后，会在图纸上进行审图批注，批注的内容会保存到服务器或原图纸中，下面我们将讲一下在线浏览标注DWG图纸后保存批注信息的方法。")]),t._v(" "),s("h2",{attrs:{id:"批注保存到服务器的数据库中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#批注保存到服务器的数据库中"}},[t._v("#")]),t._v(" 批注保存到服务器的数据库中")]),t._v(" "),s("p",[t._v("第一种方式是将图纸中的批注或绘图数据通过 "),s("a",{attrs:{href:"https://mxcad.github.io/mxdraw_api_docs/classes/MxDrawObject.html#saveMxEntityToJson",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mx.MxFun.getCurrentDraw().saveMxEntityToJson()"),s("OutboundLink")],1),t._v(" 方法转换为JSON字符串保存到服务器的数据库中，当再次打开这张图纸的时候，再去请求得到对应的批注数据，通过 "),s("a",{attrs:{href:"https://mxcad.github.io/mxdraw_api_docs/classes/MxDrawObject.html#loadMxEntityFromJson",target:"_blank",rel:"noopener noreferrer"}},[t._v("MxFun.getCurrentDraw().loadMxEntityFromJson()"),s("OutboundLink")],1),t._v(" 方法在前端页面中直接恢复对应的批注或绘图数据。")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 保存批注")]),t._v("\nlocalStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mx-data'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Mx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MxFun"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCurrentDraw")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("saveMxEntityToJson")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 恢复批注")]),t._v("\nMx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MxFun"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCurrentDraw")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadMxEntityFromJson")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mx-data'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),s("h2",{attrs:{id:"批注保存到图纸中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#批注保存到图纸中"}},[t._v("#")]),t._v(" 批注保存到图纸中")]),t._v(" "),s("p",[t._v("第二种方式是将图纸上的批注或绘图内容直接保存到图纸上, 该种方式需在服务器中提前保存目标图纸的原图纸。我们提供了一个应用程序能够将批注或绘图内容与目标图纸合并保存，下面是其操作步骤：")]),t._v(" "),s("ol",[s("li",[t._v("配置")])]),t._v(" "),s("p",[t._v("在"),s("a",{attrs:{href:"https://help.mxdraw.com/?pid=32&keywords=",target:"_blank",rel:"noopener noreferrer"}},[t._v("MxDraw云图开发包"),s("OutboundLink")],1),t._v("中进入"),s("code",[t._v("MxDrawServer")]),t._v("目录")]),t._v(" "),s("p",[t._v("在该目录中存在一个"),s("code",[t._v("ini.js")]),t._v("文件中的"),s("code",[t._v("MxINI")]),t._v("函数中可以配置服务参数:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://admin.mxdraw3d.com/images/ueditor/1602201516373053440.png",alt:"MxDrawServer MxINI 配置截图"}})]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("启动node服务")])]),t._v(" "),s("ul",[s("li",[t._v("Windows系统:")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://admin.mxdraw3d.com/images/ueditor/1602630025566359552.png",alt:"Windows MxDrawServer 目录截图"}})]),t._v(" "),s("p",[t._v("双击运行"),s("code",[t._v("start.bat")]),t._v("文件 启动node服务")]),t._v(" "),s("ul",[s("li",[t._v("Linux系统:")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://admin.mxdraw3d.com/images/ueditor/1602630091471458304.png",alt:"Linux MxDrawServer 目录截图"}})]),t._v(" "),s("p",[t._v("首先进入"),s("code",[t._v("Bin\\Linux\\Bin")]),t._v(" 目录增加文件的执行权限")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v(" root\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" -R "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("777")]),t._v(" *\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -r ./mx /mx\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" -R "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("777")]),t._v(" /mx/*\n")])])]),s("p",[t._v("然后进入"),s("code",[t._v("Bin\\Linux\\MxDrawServer")]),t._v(" 目录 执行如下命令")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v(" root\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" -R "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("777")]),t._v(" *\n./node app.js\n")])])]),s("p",[t._v("其中保存批注到DWG文件的接口是"),s("code",[t._v("savecomment")]),t._v("，其参数如下:")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("filename")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"保存到的DWG文件"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("savefile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"保存后的dwg"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userConvertPath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("你也可以参考"),s("code",[t._v("MxDrawServer")]),t._v("项目源码写出自己的后台服务。")]),t._v(" "),s("h2",{attrs:{id:"其他"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[t._v("#")]),t._v(" 其他")]),t._v(" "),s("p",[t._v("更多服务请参考"),s("a",{attrs:{href:"https://help.mxdraw.com/?pid=115",target:"_blank",rel:"noopener noreferrer"}},[t._v("梦想云图Node.JS服务"),s("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=r.exports}}]);